(function($){
	
	var initComponent = function(){
		$(".modal").on("shown.bs.modal",function(){
			$(this).find("form :input:not(:disabled):not(:hidden)").first().focus();
		});
		
		$(".btn").button();
		
		$("form[valid!='false']").each(function(i,o){
			var temp = $(o);
			
			temp.find(":input:not(:disabled):not(:hidden)").first().focus();
			
			temp.validate({
				submitHandler : function(form) {
					form.submit();
				}
			});
			
			temp.find("button[type='reset']").click(function(){
				
				temp.find("input:not(:disabled):not(:hidden)").each(function(i,field){
					$(field).val("");
				});
				
				temp.find("select:not(:disabled):not(:hidden)").each(function(i,field){
					$(field).val("");
				});
				
				temp.find("textarea:not(:disabled):not(:hidden)").each(function(i,field){
					$(field).val("");
				});
				
				return false;
			});
			
		});
	};

	$.validator.setDefaults({
		showErrors : function(errorMap, errorList) {
			$.each(this.successList,function(i,e){
				var element = $(e);
				element.parent("div").removeClass("has-error");
				element.tooltip("destroy");
			});
			
			$.each(errorList, function(i, e) {
				var element = $(e.element);
				var tip = element.data('bs.tooltip');
				if ($.isNotEmpty(tip)) {
					tip.options.title = e.message;
					element.next().children(".tooltip-inner").html(e.message);
				} else {
					element.parent("div").addClass("has-error");
					element.tooltip({
						title:e.message,
						trigger:"focus"
					});
				}
			});
		}
	});
	
	$(document).ready(function(){
		
		var userAgent = function() {
	    	ua = navigator.userAgent.toLowerCase();
	
	    	var match = /(msie) ([\w.]+)/.exec( ua );
	
	    	return {
	    		name: $.isEmpty(match) ? "" : match[ 1 ] || "",
	    		version: $.isEmpty(match) ? "" : match[ 2 ] || "0"
	    	};
	    },
	    browser = userAgent();
	    
	    
	    if (browser.name ==="msie" && browser.version < 8) {
	    	$(".main-container").html(
		    	'<div class="server-error">' +
		    		'<p><center><img src="resource/image/ie.png"></center></p>' +
		    		'<p>&nbsp;</p>' +
		    		'<h3>浏览器不兼容</h3>' +
		    		'<hr>' +
		    		'<p>您的刘浏览器版本过低，<a href="http://windows.microsoft.com/zh-cn/internet-explorer/download-ie">请升级IE到最新版本</a></p>' +
		    	'</div>'
	    	);
	    } else {
			initComponent();
	    }
	});
	
})(jQuery);
