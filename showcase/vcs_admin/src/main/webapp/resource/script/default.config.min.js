(function($){
	var backdrop = $("<div>").addClass("modal-backdrop absolute fade in");
	
	var mask = function(target){
		$(target).append(backdrop);
	},
	unmask = function() {
		$(".modal-backdrop").remove();
	};

	$(window).ajaxStop(function(){
		
		unmask();

		$(".collapse").collapse();
		$(".btn").button();
		$(".alert").alert();
		
		$("form").each(function(i,o){
			$(o).validate({
				submitHandler : function(f) {
					var form = $(f),target = form.attr("data-target");
					
					form.ajaxSubmit({
						beforeSubmit:function(formData, jqForm, options){
							mask(target);
						},
						success:function(response,state,options,from) {
							$(target).html(response);
						}
					});
				}
			});
		});

	});
	
	$.extend(jQuery,{
		maskload:function(target,url,data,callback,type) {
			if ($.isFunction(data)) {
				type = type || callback;
				callback = data;
				data = undefined;
			}
			
			mask(target);
			
			$.post(url,data,function(response,state,options){
				$(target).html(response);
				if ($.isFunction(callback)) {
					callback(response,state,options);
				}
			},type);
			
			return this;
		}
	});
	
	$.extend(jQuery.fn,{
		maskload:function(url,data,callback) {
			mask($(this));
			this.load(url,data,callback);
			return this;
		}
	});
	
})(jQuery);

