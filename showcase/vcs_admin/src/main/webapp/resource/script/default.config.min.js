function overlayAjax(config) {
	var backdrop = $("<div>").addClass("modal-backdrop absolute fade in");
	
	var onBeforeAjaxFormValidation = function() {
		if ($.isFunction(config.onBeforeAjaxFormValidation) && 
				config.onBeforeAjaxFormValidation() === false) {
			return false;
		}
		$(config.target).append(backdrop);
	};
	
	var onAjaxFormComplete = function(o) {
		backdrop.remove();
		var appendTarget = $(config.target) || $(config.appendTarget);
		appendTarget.html(o.response);
		
		if ($.isFunction(config.onAjaxFormComplete)){
			config.onAjaxFormComplete(o);
		}
	};
	
	if($.isEmpty(config.form)) {
		if (onBeforeAjaxFormValidation() !== false) {
			$.post(config.url,config.param,function(response) {
				onAjaxFormComplete(response);
			});
		}
	} else {
		
		var form = $(config.form);
		
		if ($.isEmpty(form.attr("validate")) || !form.attr("validate").booleanValue()) {
			
			form.validationEngine({
				ajaxFormValidation: true,
				dataType:config.dataType || "text",
				ajaxFormValidationMethod:form.attr("method"),
				onBeforeAjaxFormValidation:onBeforeAjaxFormValidation,
				onAjaxFormComplete: function(status, form, response, options){
					onAjaxFormComplete({
						status:status,
						form:form,
						response:response,
						options:options
					});
		        }
			});
			
			form.attr("validate",true);
		}
	}
}

/**
 * 加载模块
 * 
 * @param a accordion下的a标签
 */
function loadModule(a) {
	var href = a.attr("href"),
	url = href.substring(1,href.length);
	overlayAjax({
		url:url.substring(0,url.length -3),
		target:"#module-content"
	});
}

function initMainCompont() {
	$(".collapse").collapse();
	
	$(".nav.navbar-nav").find("li").children("a").click(function() {
		$(".nav.navbar-nav").find(".accordion").fadeOut("fast");
		$(".nav.navbar-nav").find("li.active").removeClass("active");
		
		var li = $(this).parent();
		li.children(".accordion").fadeIn("fast");
		li.addClass("active");
		
	});
	
	$(".nav.navbar-nav").find(".accordion a").click(function(e){
		var a = $(this);
		a.parents(".accordion").find(".active").removeClass("active");
		a.addClass("active");
		loadModule(a);
		
	});
}

$(document).ready(function() {
    $("#main-container").load("main",function() {
    	initMainCompont();
    });
});
